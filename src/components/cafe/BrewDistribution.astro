---
import { useTranslations, type Locale } from '@/lib/i18n';

interface BrewMethodData {
  method: string;
  count: number;
  percentage: number;
}

interface Props {
  distribution: BrewMethodData[];
  locale: Locale;
}

const { distribution, locale } = Astro.props;
const { t } = useTranslations(locale);
---

<section class="brew-method-section">
  <h2>{t('cafe.sections.brewMethods')}</h2>
  <div class="brew-method-bars">
    {
      distribution.map((method) => (
        <div class="bar-container">
          <span class="method-name">{method.method}</span>
          <div class="bar-wrapper">
            <div
              class="bar"
              style={`width: ${method.percentage}%`}
              data-method={method.method.toLowerCase()}
            />
          </div>
          <span class="stats">
            {method.percentage}% ({method.count})
          </span>
        </div>
      ))
    }
  </div>
</section>

<style>
  .brew-method-section {
    background: var(--pico-card-background-color);
    border: 1px solid var(--pico-card-border-color);
    border-radius: var(--pico-border-radius);
    padding: 2rem;
    margin-bottom: 3rem;
  }

  .brew-method-section h2 {
    margin-top: 0;
    margin-bottom: 1.5rem;
  }

  .brew-method-bars {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .bar-container {
    display: grid;
    grid-template-columns: 120px 1fr auto;
    gap: 1rem;
    align-items: center;
  }

  .method-name {
    font-weight: 600;
    color: var(--pico-color);
  }

  .bar-wrapper {
    background: var(--pico-background-color);
    border-radius: 0.25rem;
    height: 36px;
    overflow: hidden;
  }

  .bar {
    height: 100%;
    border-radius: 0.25rem;
    transition: width 0.3s ease;
    min-width: 2%;
  }

  .bar[data-method='espresso'] {
    background: #6f4e37;
  }

  .bar[data-method='aeropress'] {
    background: #8b6f47;
  }

  .bar[data-method='french press'] {
    background: #a0826d;
  }

  :global([data-theme='dark']) .bar[data-method='espresso'] {
    background: #9d6f4f;
  }

  :global([data-theme='dark']) .bar[data-method='aeropress'] {
    background: #b88d5f;
  }

  :global([data-theme='dark']) .bar[data-method='french press'] {
    background: #c4a47f;
  }

  .bar-container .stats {
    font-family: monospace;
    font-size: 0.875rem;
    color: var(--pico-muted-color);
    white-space: nowrap;
  }

  @media (max-width: 768px) {
    .brew-method-section {
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .bar-container {
      grid-template-columns: 1fr;
      gap: 0.5rem;
    }

    .bar-wrapper {
      order: 2;
    }

    .stats {
      order: 3;
    }
  }
</style>
