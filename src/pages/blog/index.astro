---
import Layout from '../../layouts/Layout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import { getBlogPostUrl } from '@/lib/i18n';

let posts: CollectionEntry<'blog'>[] = [];
try {
  posts = await getCollection('blog', ({ data }) => data.locale === 'en');
  posts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
} catch (e) {
  console.warn('No blog posts found:', e);
}
---

<Layout title="Blog" description="Thoughts on software engineering, triathlon, and life">
  <header class="hero">
    <h1>Blog</h1>
    <p>Thoughts on software engineering, triathlon training, and life</p>
  </header>

  <section>
    {posts.length > 0 ? (
      <div style="display: grid; gap: 2rem; margin-top: 2rem;">
        {posts.map((post) => (
          <article class="blog-card">
            <div class="blog-meta">
              <time datetime={post.data.pubDate.toISOString()}>
                {post.data.pubDate.toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric',
                })}
              </time>
            </div>
            <header>
              <h2>
                <a href={getBlogPostUrl(post)}>{post.data.title}</a>
              </h2>
            </header>
            {post.data.description && (
              <p style="color: var(--pico-muted-color); line-height: 1.6;">
                {post.data.description}
              </p>
            )}
            <footer>
              <a href={getBlogPostUrl(post)} style="font-weight: 500;">
                Read more â†’
              </a>
            </footer>
          </article>
        ))}
      </div>
    ) : (
      <div style="text-align: center; padding: 4rem 0;">
        <p style="font-size: 1.125rem; color: var(--pico-muted-color);">
          No blog posts yet. Check back soon for updates on engineering, triathlon training, and life as a dad!
        </p>
      </div>
    )}
  </section>
</Layout>