---
import Layout from '../../layouts/Layout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

let posts: CollectionEntry<'blog'>[] = [];
try {
  posts = await getCollection('blog');
  posts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
} catch (e) {
  console.warn('No blog posts found:', e);
}
---

<Layout title="Blog">
  <header>
    <h1>Blog</h1>
    <p>Thoughts on engineering, triathlon, and life</p>
  </header>

  <section>
    {posts.length > 0 ? (
      <div>
        {posts.map(post => (
          <article>
            <header>
              <h2><a href={`/blog/${post.slug}`}>{post.data.title}</a></h2>
              <p><small>{post.data.pubDate.toLocaleDateString()}</small></p>
            </header>
            {post.data.description && <p>{post.data.description}</p>}
          </article>
        ))}
      </div>
    ) : (
      <div>
        <p>No blog posts yet. Check back soon for updates on engineering, triathlon training, and life as a dad!</p>
        <a href="/admin" role="button">Write a post â†’</a>
      </div>
    )}
  </section>
</Layout>