---
import Layout from '../../layouts/Layout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

let posts: CollectionEntry<'blog'>[] = [];
try {
  posts = await getCollection('blog');
  posts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
} catch (e) {
  console.warn('No blog posts found:', e);
}

// Helper function to estimate reading time
function getReadingTime(content: string): number {
  const wordsPerMinute = 200;
  const words = content.split(/\s+/).length;
  return Math.ceil(words / wordsPerMinute);
}
---

<Layout title="Blog" description="Thoughts on software engineering, triathlon training, and life">
  <header class="hero">
    <h1>Blog</h1>
    <p>Thoughts on software engineering, triathlon training, and life</p>
  </header>

  <section>
    {posts.length > 0 ? (
      <div style="display: grid; gap: 2rem; margin-top: 2rem;">
        {posts.map(async (post) => {
          const { remarkPluginFrontmatter } = await post.render();
          return (
            <article class="blog-card">
              <div class="blog-meta">
                <time datetime={post.data.pubDate.toISOString()}>
                  {post.data.pubDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                  })}
                </time>
                {post.data.tags && post.data.tags.length > 0 && (
                  <span class="blog-tag">{post.data.tags[0]}</span>
                )}
              </div>
              <header>
                <h2>
                  <a href={`/blog/${post.slug}`}>{post.data.title}</a>
                </h2>
              </header>
              {post.data.description && (
                <p style="color: var(--pico-muted-color); line-height: 1.6;">
                  {post.data.description}
                </p>
              )}
              <footer>
                <a href={`/blog/${post.slug}`} style="font-weight: 500;">
                  Read more â†’
                </a>
              </footer>
            </article>
          );
        })}
      </div>
    ) : (
      <div style="text-align: center; padding: 4rem 0;">
        <p style="font-size: 1.125rem; color: var(--pico-muted-color);">
          No blog posts yet. Check back soon for updates on engineering, triathlon training, and life as a dad!
        </p>
      </div>
    )}
  </section>
</Layout>