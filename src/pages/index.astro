---
import Layout from '../layouts/Layout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import { getBlogPostUrl } from '@/lib/i18n';

// Fetch recent English blog posts
let recentPosts: CollectionEntry<'blog'>[] = [];
try {
  const posts = await getCollection('blog', ({ data }) => data.locale === 'en');
  recentPosts = posts
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
    .slice(0, 3);
} catch (e) {
  console.warn('No blog posts found:', e);
}
---

<Layout title="Home">
  <header class="hero">
    <h1>Christian Rodriguez</h1>
    <p>Software Engineer • Triathlete • Dad</p>
    <p style="margin-top: 1.5rem;">
      <a href="/blog" role="button">Read the blog</a>
      <a href="/about" role="button" class="secondary">About me</a>
    </p>
  </header>

  {recentPosts.length > 0 && (
    <section style="margin-top: 4rem;">
      <header style="margin-bottom: 2rem;">
        <h2 style="font-size: 1.75rem; font-weight: 700; letter-spacing: -0.025em;">Latest posts</h2>
      </header>

      <div style="display: grid; gap: 2rem;">
        {recentPosts.map((post) => (
          <article class="blog-card">
            <div class="blog-meta">
              <time datetime={post.data.pubDate.toISOString()}>
                {post.data.pubDate.toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric',
                })}
              </time>
            </div>
            <header>
              <h3>
                <a href={getBlogPostUrl(post)}>{post.data.title}</a>
              </h3>
            </header>
            {post.data.description && (
              <p style="color: var(--pico-muted-color); line-height: 1.6;">
                {post.data.description}
              </p>
            )}
            <footer>
              <a href={getBlogPostUrl(post)} style="font-weight: 500;">
                Read more →
              </a>
            </footer>
          </article>
        ))}
      </div>

      <div style="margin-top: 2rem; text-align: center;">
        <a href="/blog">View all posts →</a>
      </div>
    </section>
  )}

  <section style="margin-top: 4rem; padding: 3rem 0; border-top: 1px solid var(--pico-muted-border-color);">
    <div style="text-align: center;">
      <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;">Let's connect</h2>
      <p style="color: var(--pico-muted-color); margin-bottom: 1.5rem;">
        I write about software engineering, triathlon training, and life.
      </p>
      <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
        <a href="https://github.com/chrisrodz" target="_blank" rel="noopener noreferrer">GitHub</a>
      </div>
    </div>
  </section>
</Layout>
