# Claude Code Workflow Guidelines

## Branch Strategy

**Always work on feature branches** to protect the `main` branch which is deployed to production.

### Workflow:
1. **Create feature branch** from main:
   ```bash
   git checkout main
   git pull
   git checkout -b feature/your-feature-name
   ```

2. **Make changes** on the feature branch
   - Test locally with `yarn dev`
   - Build to verify: `yarn build`

3. **Commit frequently** with clear messages
   ```bash
   git add .
   git commit -m "descriptive message"
   ```

4. **Push to GitHub**:
   ```bash
   git push -u origin feature/your-feature-name
   ```

5. **Create Pull Request** when ready
   - Review changes in GitHub
   - Get approval (or self-review)
   - Merge to main

6. **Clean up**:
   ```bash
   git checkout main
   git pull
   git branch -d feature/your-feature-name
   ```

### Branch Naming Convention:
- `feature/` - New features or enhancements
- `fix/` - Bug fixes
- `docs/` - Documentation updates
- `refactor/` - Code refactoring

## Deployment

- **Main branch** auto-deploys to production (Vercel)
- **Feature branches** do NOT auto-deploy (unless PR created)
- **Preview deployments** available for PRs

## Project-Specific Notes

### Current Stack:
- **Framework**: Astro v5.14+
- **Styling**: Pico CSS + Tailwind CSS
- **Database**: Supabase (optional, graceful degradation)
- **Auth**: Custom session-based (nanoid)
- **Validation**: Zod schemas
- **Deployment**: Vercel (Node.js 20+)

### Key Files:
- `src/layouts/Layout.astro` - Main layout template
- `src/pages/` - All routes
- `src/content/blog/` - Markdown blog posts
- `src/lib/` - Utilities (auth, supabase, validation)
- `astro.config.mjs` - Astro configuration
- `tailwind.config.mjs` - Tailwind theme

### Local Development:
```bash
yarn install          # Install dependencies
yarn dev             # Start dev server (localhost:4321)
yarn build           # Production build
yarn preview         # Preview production build
yarn new-post "Title" # Create new blog post
```

### Environment Variables:
- `ADMIN_SECRET` - Admin panel password (required)
- `PUBLIC_SUPABASE_URL` - Supabase URL (optional)
- `PUBLIC_SUPABASE_ANON_KEY` - Supabase anon key (optional)
- `SUPABASE_SERVICE_KEY` - Supabase service key (optional)

Site works without Supabase - coffee/training features gracefully degrade.

## Best Practices

1. **Always test locally** before pushing
2. **Keep commits atomic** - one logical change per commit
3. **Write clear commit messages**
4. **Update README** when adding features
5. **Use feature branches** - never commit directly to main
6. **Review your own PRs** before merging

---

Last updated: 2025-10-09
